general:
  branches:
    only:
      - appium-poc
machine:
  environment:
    _JAVA_OPTIONS: "-Xms512m -Xmx1024m"
    GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xmx2048m -XX:+HeapDumpOnOutOfMemoryError"'
  node:
    version: 8.1.2
dependencies:
    pre:
      - echo y | android update sdk --no-ui --all --filter "tools,platform-tools,android-24"
      - echo y | android update sdk --no-ui --all --filter "build-tools-24.0.1"
    override:
        - npm install -g appium
test:
    override:
    - npm run testandroid-circle
    pre:
    - emulator -avd circleci-android24 -no-window:
        background: true
        parallel: true
    - circle-android wait-for-boot
    - yarn run appium:
            background: true
    # unlock the emulator screen
    - yarn run android
    - sleep 30
    - adb shell input keyevent 82
    - adb shell screencap -p | sed 's/\r$//' > bootscreen.png